# cap3d_view

[![DOI](https://zenodo.org/badge/DOI/10.5281/zenodo.16363911.svg)](https://doi.org/10.5281/zenodo.16363911)

A Python tool for visualizing 3D geometry and block construction from CAP3D files generated by the RWCap tool (for calculating capacitances of 3-D structures). This project provides both interactive 3D visualization and static plotting, with an animation of block construction to help understand the geometry described in .cap3d files.

**Citation & Metadata:**

- This repository is metadata-locked via a [CITATION.cff](CITATION.cff) file.
- Please cite using the Zenodo DOI below.
- **DOI for this version:** [10.5281/zenodo.16406690](https://doi.org/10.5281/zenodo.16363911)
- **Concept DOI:** [10.5281/zenodo.16406690](https://doi.org/10.5281/zenodo.16363911)
- RWCap-v4: floating Random Walk based Capacitance solver for conductor structures. Version 4       released. [2023] (Numerical methods for big data / design automation) Group

### üöÄ Enhanced Version (cap3d_enhanced.py) - Production Ready

- **2.17x faster** parsing than standard version with **14% less memory usage**
- Optimized for large CAP3D files (tested on 747+ files) with true streaming parser
- Advanced Level of Detail (LOD) system for handling massive datasets
- High-performance 3D visualization with intelligent block filtering
- Memory-efficient line-by-line processing (no regex, pure state machine)
- Inspired by `LEVEL OF DETAIL` from TU Delft for integrated circuit visualization
- **See `src/cap3d_enhanced_README.md` for comprehensive technical documentation**

**Performance Benchmarks (747 test files):**

- Average parse time: 14.4ms vs 31.2ms (standard)
- Average memory usage: 0.08MB vs 0.09MB (standard)
- 100% parsing accuracy maintained

 ![LOD](docs/LOD.png)

## Interactive Version (Recommended)

The **new Plotly version** (`cap3d_plotly.py`) provides a modern, interactive 3D visualization experience with enhanced features:

### Features

- **Interactive 3D visualization** with mouse controls (rotate, zoom, pan)
- **Component toggling** - Show/hide mediums and conductors independently
- **Enhanced hover information** - Detailed component data on mouse-over
- **Multiple view modes** - Complete, mediums-only, conductors-only, and z-sliced views
- **Professional styling** - Better colors, transparency, and layout
- **Dashboard interface** - Menu-driven visualization options
- **Automatic statistics** - Component counts and dimensional analysis

### Requirements for Interactive Version

```bash
pip install numpy plotly matplotlib
```

### Usage (Interactive Version)

```bash
python cap3d_plotly.py
```

The script will:

1. Display a visualization dashboard menu with file statistics
2. Show multiple interactive 3D plots in your browser
3. Provide different view modes for comprehensive analysis

## Block Construction Animation

The animation below (generated by `src/block_animation.py`) shows how each block is built step by step from its basepoint and vectors:

![Block Construction Animation](docs/block_construction.gif)

## üìä Visualization Comparison

| Feature          | Interactive (Plotly)      | Legacy (Matplotlib)              |
| ---------------- | ------------------------- | -------------------------------- |
| 3D Controls      | ‚úÖ Mouse rotate/zoom/pan  | ‚ö†Ô∏è Limited matplotlib controls |
| Hover Info       | ‚úÖ Rich component details | ‚ùå None                          |
| Component Toggle | ‚úÖ Show/hide by type      | ‚ùå Static view                   |
| Multiple Views   | ‚úÖ Dashboard with options | ‚ùå Single view                   |
| Web Browser      | ‚úÖ Opens in browser       | ‚ùå Desktop window                |
| Performance      | ‚úÖ Smooth interaction     | ‚ö†Ô∏è Static rendering            |

## üìÇ Project Structure

```
cap3d_view/
‚îú‚îÄ‚îÄ requirements.txt        
‚îú‚îÄ‚îÄ README.md                
‚îú‚îÄ‚îÄ src/                    
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py       
‚îÇ   ‚îú‚îÄ‚îÄ cap3d_plotly.py       # Interactive visualization (recommended)
‚îÇ   ‚îú‚îÄ‚îÄ cap3d_matplotlib.py   # Legacy matplotlib version
‚îÇ   ‚îú‚îÄ‚îÄ cap3d_enhanced.py     # Enhanced large file parser (see separate README)
‚îÇ   ‚îî‚îÄ‚îÄ block_animation.py    # Block construction 
|
|
‚îú‚îÄ‚îÄ examples/                   # Sample CAP3D files
‚îÇ   ‚îú‚îÄ‚îÄ smallcaseD.cap3d        # Small example
‚îÇ   ‚îú‚îÄ‚îÄ 0_0_0_34_107_MET1.cap3d # Medium example  
‚îÇ   ‚îî‚îÄ‚îÄ freecpu2.cap3d          # Large example
‚îî‚îÄ‚îÄ docs/                    
    ‚îî‚îÄ‚îÄ block_construction.gif 
```

## Legacy Version (Matplotlib)

The original version (`cap3d_matplotlib.py`) provides static 3D visualization using matplotlib:

### Legacy Features

- Parses CAP3D files containing definitions for mediums and conductors in 3D space
- Static 3D visualization using matplotlib
- Supports z-slice visualization
- Color-coded conductors and mediums

### Legacy Requirements

```bash
pip install numpy matplotlib
```

### Legacy Usage

```bash
python src/cap3d_matplotlib.py
```

## CAP3D File Format

A CAP3D file contains sections for mediums, conductors, and a window. Each medium or conductor can have one or more blocks, each defined by:

- `basepoint(x, y, z)`: The starting corner of the block.
- `v1(dx, dy, dz)`: Vector defining one edge from the basepoint.
- `v2(dx, dy, dz)`: Vector defining another edge from the basepoint.
- `hvector(dx, dy, dz)`: Vector for the block's height/thickness.

Example block:

```
<block>
    name block1
    basepoint(-2, -2, 0)
    v1(4, 0, 0)
    v2(0, 4, 0)
    hvector(0, 0, 0.3)
</block>
```

## How it works

- The script parses the CAP3D file, extracting all mediums and conductors and their blocks
- Each block is converted into a 3D box using its basepoint and vectors
- Boxes are rendered in 3D with mediums shown as transparent and conductors as opaque
- **Interactive version**: Provides multiple view modes and interactive controls
- **Legacy version**: Shows static plots with optional z-slice visualization

## Customization

### Interactive Version

- Modify the `cap3d_file` variable in `cap3d_plotly.py`
- Use the dashboard menu to select different visualization modes
- Interactive controls allow real-time exploration

### Legacy Version

- Change the `cap3d_file` variable in `cap3d_matplotlib.py`
- Modify the `z_slice` parameter in the `draw_components` function call

## License

MIT License
